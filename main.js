var students_old = ["10240","9289","10830","9402","11356","11088","9532","10653","11436","10151","10077","8971","11420","12180","10086","10814","10850","10661","11710","9978","12187","9361","10513","10042","11472","11058","11407","11052","9483","12280","11362","11344","10651","12184","9355","11374","12194","11519","10624","11081","9396","10463","10713","9391","10649","9951","9448","10604","11056","9484","10072","10660","10772","9523","11562","10569","9573","11418","10691","11563","10866","9564","9948","9366","10727","8537","8546","10751","11578","11516","11022","9568","9543","11411","10739","11511","9517","10647","11424","10051","11048","11422","10169","9535","11475","11343","10646","10609","9403","9932","8992","9971","10495","10412","10011","9093","11057","10755","11396","10858","10457","9324","9956","9954","9221","11573","9558","11567","8818","10710","10020","10043","9109","10822","11047","9094","11034","11073","9687","11036","10067","11450","10101","9398","10853","9184","11380","9393","10477","9308","10573","11432","11388","11484","9200","9791","9363","9364","10786","9571","10630","9081","10859","11363","9559","10026","10747","10191","11038","9615","9941","9574","9330","11386","11035","9792","10639","9661","9824","8591","9915","9365","10632","10704","10187","10071","9443","9676","10095","10090","9525","10656","9478","10643","12146","11408","12191","11369","9197","9248","10737","10743","11506","11714","9527","11030","11559","9958","10650","10038","10076","10631","10079","12197","11024","11059","9965","10080","10190","9802","10688","9570","9632","11510","9797","11416","11399","9397","10447","10085","9673","10015","9227","9560","9420","10056","11037","10054","11498","10055","8977","8997","9809","9405","10516","9153","10014","12179","10035","9546","9399","10170","10735","9400","10174","9348","9518","9561","9445","9706","9041","9228","9799","9350","12189","9447","9607","9229","10657","9997","9990","8841","12190","9492","10053","10819","10871","12193","9430","9977","8843","10203","10429","10749","9536","9814","10100","9367","10725","9522","11568","10031","11449","9498","10598","9359","11555","10013","9831","9185","10036","9998","10723","12178","12177","11405","9996","10752","9611","10436","9547","9982","9433","9937","10854","10592","10599","10613","9208","11079","10620","11572","12183","12195","10084","10763","10037","9125","9833","11346","11345","12201","11431","10010","10628","12202","10034","9949","12188","9272","10025","8598","11009","10716","9230","9434","11045","11512","12149","10659","10644","11082","10857","10820","10790","10057","9485","9486","9204","10021","10741","10709","11353","10023","10570","11508","10411","9966","9205","11423","11063","11514","9457","9538","10596","9370","9436","10701","10615","12185","9231","10424","9944","10608","11076","10835","9119","10633","11395","8849","8572","10504","11359","11201","9989","10018","9078","8543","9930","11385","9514","9015","11065","10019","10724","10730","9493","11039","11023","11381","11566","12140","11570","9512","10862","9360","11446","11435","11379","10567","10047","9991","11576","8442","11459","9909","10626","9911","11391","9834","10179","10032","10648","10856","9794","9017","9626","9955","10326","11406","9196","10695","11377","9162","11490","9952","10591","9782","10837","10754","10141","10748","9938","9959","9767","10511","9451","11050","9999","10625","9473","10017","11064","10627","9813","10373","10577","10028","11392","9389","8574","10005","9460","9513","9628","9742","11049","9963","10165","9495","9175","11368","10681","8748","10069","10515","8448","10849","9407","11447","8377","9408","10715","10745","11060","11564","10682","9097","10612","9539","9608","10697","11433","9563","10068","9409","10563","8459","10016","10654","8903","10128","9981","9410","9024","9040","9612","9531","12172","9475","9835","9005","9900","9411","10696","9633","9986","9716","10714","10427","10166","9006","9480","10722","10742","9629","9609","9575","9972","9519","10523","11390","10816","9394","12203","10075","9565","9677","9500","10798","9206","9754","9496","9953","10708","9511","11409","10726","10698","11569","10446","10663","11802","10702","10007","9720","11387","11350","9591","10614","10762","10092","9193","8378","9412","10009","10744","11549","9957","9099","9413","10236","10655","10694","9437","8337","9481","11553","11509","10033","9866","9395","10756","10738","11413","9946","9583","11367","10186","10637","8579","9933","10004","10775","9415","8517","9487","9488","9980","9181","10078","9198","10686","9940","11518","10532","10602","9100","9044","11378","11054","11355","9894","9893","9992","9023","10156","10360","9984","10027","8581","9985","8930","10388","11075","9070","10645","10148","9438","10514","10473","10601","10456","10703","9927","11398","9795","10349","9689","10173","10605","9235","9416","10199","10672","10444","10066","10073","11348","9084","9973","10618","9688","9372","11021","11571","10693","11505","9698","12174","10606","9861","11577","9189","9515","11419","9237","9796","11085","11403","10045","12192","9566","10811","9440","10445","11018","9862","9441","10721","9011","9520","8356","10662","9540","9650","11427","10188","9207","9417","9209","10728","10821","9979","9907","9906","9787","9657","10677","9975","11485"];
var students = ["Aalders","Aalst  van","Aart  van","Aarts","Aartsen","Abbenhuis","Abdirahman","Abou-Nour","Abouchachi","Acar","Achamlal","Adawe","Adawe","Adelhart Toorop  de","Ahbouk","Ahbouki","Ahbouki","Ahidar","Ahmed","Ahmed","Ajaid","Ajaouin","Ajoun","Ak","Akat","Akdemir","Aksoy","Akyol","Akyürek","Alberto","Albertoe","Ali","Ali","Alizada","Alkema","Altun","Amin","Amini","Andel  van","Andjelkovic","Andringa","Appels","Arends","Arends","Arentsen","Askali","Asontoe","Asselman","Ates","Atesci","Atmani","Avdic","Aydemir","Aydin","Azarkane","Azdidi","Azizyaar","Baak","Baars","Badjalala","Bagher Chopani","Bahador","Bakker","Balk","Baltissen","Baptist","Barten","Bartolomeu Canhanga","Basaran","Battal","Baydemir","Bea","Becic","Beek","Beekman","Bektas","Beljon","Bemd  van den","Benjamins","Bensalah","Berends","Berendsen","Berenschot","Bergh  van den","Besseling","Beyogullari","Bilbas","Bink","Binnebeke  van","Bloem","Blok","Boer","Boers","Bogaerts","Bogaerts","Böhmer","Böhmermann","Bolder","Bom  van der","Bommel  van","Bommel  van","Boonacker","Borst","Bos","Bos","Bosman","Bostanci","Both  de","Both  de","Bou-raarassi","Bouaissa","Bouguiour","Bouguiour","Bouhid","Boulahdaraj","Bouman","Bouraarassi","Bourich","Bouwmeester","Boyacioglu","Boyacioglu","Boyce","Bozakraft","Brand  van den","Brbar","Breems  den","Broekhuijze  van","Brouwer","Brouwer","Bruin  de","Bruno","Brussee","Buijs","Bulgurcu","Buma","Burger  de","Busch","Bussink","Cakirgoz","Calvino Alonso","Calviño Alonso","Çan","Cancilleri","Casonato","Cazemier","Cetin","Ceylan","Chan","Chen","Çiftçi","Clappers","Çobanoglu","Coenen","Coonen","Cornelisse","Cornelissen","Cosgun","Dalen  van","Dalen  van","Dam","Damen","Danielson","Danielson","Darim","Degen","Dekker","Demiraj","Demircan","Demiroglu","Demirtas","Demirtas","Detmers","Dieker","Diémé","Diephuis","Diephuis","Diepstraten","Dijk","Dijkstra","Dingemans","Dinnissen","Doekhi","Does  de","Dokter","Donckers","Dönmez","Doornhein","Doornkamp","Dorani","Drissen","Durmus","Ecevit","Eelsing","Egepehliven","El Atrach","El Bachrioui","El Berkani","El Farissi","El Farissi","El Fassi","El Haddad","El Haj","El Messaoudi","Elabed","Eldik  van","Elst  van der","Emen","Engel","Erköse","Esman","Esman","Euverman","Evers","Evers","Evers","Faez","Faraj","Farkhani","Flipse","Flipse","Foort","Frederiks","Frencken","Freriks","Gaas","Garibyar","Garttener","Gashi","Gashi","Geessinck","Gerdes","Gerlach","Gerlofs","Gerritsen","Geurts","Giesbers","Giesen","Ginkel  van","Goed","Goinga  van","Goossens","Gorkum  van","Gözel","Grau","Groen","Groenendijk","Grootaarts","Grootaarts","Grootfaam","Grootfaam","Gros","Gülseven","Gülzelyagci","Günes","Günes","Güneyli","Güngör","Gurpinar","Haaijman","Hagen","Hagen","Haggi Moni","Hagverdy","Hakkenberg","Haldizoglu","Hamedali","Hamid","Haque","Hardeman","Hardeman","Harmsen","Hartog  den","Hassan","Hato","Heijmen","Hentzepeter","Hercules","Hereman","Hertog  den","Heuveling","Hobé","Hobson","Hoeneveld","Holdijk","Holdijk","Holt","Holthof","Hondeveld","Hong","Hoogstraten","Hoogstraten","Hoogveld","Hoorn","Horst","Hoven","Hulshoff","Hunenstijn  van","Huynh","IJzendoorn","Imeraj","Imeraj","Ingen  van","Ipek","Ipek","Isik","Issmaili","Jaflaum","Jagmohan","Jalloh","Janga","Janga","Jansen","Jansen","Jansen","Jansen","Jansen","Jansen","Janssen","Janzen","Jhanjhan","Jimale","Jong  de","Jong  de","Jong  de","Jonis","Jonker","Juliana","Kaamel","Kadah","Kaddar","Kadioglu","Kalleci","Kallon","Kamau","Kamphorst","Kamps","Kankal","Kapel","Kapena","Kara","Karaca","Karazi","Kassimi","Kayhan","Kemp  van der","Kessissa","Keyfci","Khalil","Khatraoui","Khatraoui","Khemai","Khemai","Khodabaks","Kiliç","Kiliç","Kilinç","Kipp","Kippersluis  van","Kleef  van","Kleijn","Klein Ikkink","Klein Leugemors","Kleinen","Koffy","Kok","Koldeweij","Kooij","Koot","Korblet","Kort  de","Kortenhof  van","Korthouwer","Köse","Köse","Köse","Koubaa","Koysuren","Koziara","Kramer","Kramer","Kraster","Krieg","Kristinsson","Kroneraff","Kroon  de","Kroon  de","Kücük","Küçük","Kuijs","Kuiper","Kulezic","Kuppenveld  van","Kurt","Kuyucak","L'Isle  van de","L'Isle  van de","Laan","Lagerwey","Lamers","Lamoré","Lange  de","Langeveld","Larbui","Le","Leenders","Leer  van der","Leeuw  de","Lei","Lescano Geevers","Leurink","Levi","Lin","Linden  van der","Lith  van","Lizarazo Fuentes","Lodders","Lommers","Loo  van der","Lopulissa","Losscher","Lukkien","Maassen","Mahadew","Mahamed Saadis","Mahamed Saadis","Malki","Mansaray","Manuhutu","Mapinga","Marcus","Maresch","Maria","Martinus","Meer  van der","Meeteren  van","Meijer","Meijer","Mert","Meza  de","Michels","Middelbeek","Middeldorp","Mierlo  van","Miggelbrink","Mijland","Mkrtumian","Moeliker","Mohammed","Molenaar","Möller","Mons","Munster  van","Musayeva","Music","Muste","Nabard","Nabard","Neelis","Neerhof","Nguyen","Nigl","Nijbroek","Niyazi","Nums","Nurin","Obude","Oliveros Cubillos","Omar","Omercevic","Ong Afat","Onstein","Onstein","Oostdijk","Ortega Wesseling","Otabor","Ouali","Özdemir","Özgür","Özhan","Özhan","Özlü","Özlü","Özturk","Pas  te","Pasanea","Pasman","Pawirodirjo","Peek","Peek","Peters","Peters","Pham","Phan","Philip","Pieper","Plattel","Polhaupessy","Poliakov","Polman","Ponsen","Praster","Put","Put","Putmans","Quarz","Raats","Rashid","Rasing","Redegeld","Refos","Resitoglu","Rietberg","Rietveld","Rietveld","Rijkaart van Cappellen","Rijkaart van Cappellen","Rijnberk  van","Rijst  van der","Rikken","Roelofs","Roes","Rossem  van","Röttjers","Röttjers","Roux le","Ruiz","Rutgers","Sagradian","Sagsu","Sai-Yiou","Saidi","Saini","Sajic","Salki","Salleh","Samoedj","Samuels","Sarbachta","Sayed","Sbaï","Schaeffer","Scheenstra","Scheffer","Schelkers","Schiffers","Schiffers","Schijndel  van","Schoenmaker","Schot","Schothuis","Schouten","Schreijenberg","Schulte","Segers","Segers","Seker","Selimovic","Sevilir","Sivridag","Slotboom","Slutter","Smal","Smallenburg","Smeitink","Smiesing","Smith","Smith","Smits","Smits","Snelders","Snoep","Soehani","Souidi","Soultana","Spanbroek","Spijt  van der","Spoelstra","Stockentree","Stoffels","Stoks","Straus","Struijck","Stukker","Suchý","Sueters","Sulaiman","Swam","Swaria","Swelsen","Taat","Tabak","Tabak","Tahrioui","Tajjiou","Talabani","Tammeling","Taqawi","Taqawi","Teering","Tempel","Terng","Teryaki","Tesink","Tesink","Teunissen","Teunissen","Teunissen","Thannhauser","Thomma","Thürkow","Tokic","Tomassen","Tong","Tromp","Tüfek","Turba","Türkkani","Türkoglu","Ullersma","Vaassen","Vacquier Droop","Vastenholt","Veen  van der","Veenendaal  van","Veggel  van","Veld  in 't","Veldhuizen  van","Veldkamp","Verbeek","Verburgt","Verfuurden","Vermeulen","Versteeg","Versteeg","Vertrouwd","Verwaaijen","Verwaaijen","Vette","Vorst  van der","Vorst  van der","Vorst  van der","Vos","Vos","Vossen","Vreeburg","Vreemann","Vries  de","Vries  de","Vries  de","Vugt  van","Wals  van der","Wandel","Weijer  de","Weijers","Weijtens","Wenker","Wenno","Wenno","Whieskie","Wijler","Wijngaarden  van","Willekens","Willemsen","Winters","Woest","Wolff","Wollenberg  van den","Wolterink","Worm","Woude  van der","Wouters","Wubben","Yakici","Yang","Yavuz","Yazici","Yetim","Yîldirim","Yilmaz","Yren  van","Zanten  van","Zanten  van","Zaoui","Zee  van der","Zeeuw  de","Zeeuw  de","Zenan","Ziel  van","Zonnenberg","Zwager","Zweers"];
var teachers = ["ABN","ADM","ADR","ARN","BJJ","BKH","BKN","BKR","BOR","BRH","BRJ","BRK","BRM","BSC","BTN","DJK","DMD","DMN","DPP","DRC","DRK","DTS","DTV","EER","ELF","ELZ","ERK","EST","EVM","EVR","GNS","GRH","GRV","GTH","HGS","HKS","HMA","HMD","HPK","HRT","HSA","HSD","HSI","HSM","HUT","HZL","JCB","JNJ","JNT","JNW","KHH","KLK","KLS","KND","KNN","KPM","KRG","KRK","KRV","KST","LBL","LCR","LFN","LMM","LNG","MLL","MRN","MST","OLS","OSC","OST","OZC","PER","PLT","POL","PRJ","RDN","RSS","SCJ","SCK","SCL","SLH","SLM","SLS","SLT","SMD","SNJ","SPM","SPR","STD","STF","STM","STR","SVY","SWS","TAK","THN","TMN","TRN","UBB","ULB","VLD","VRC","VRG","VSS","WNN","WNT","WTR","ZDN","ZNT","ZWR","ZWS"];

var next_week = true ;

date = new Date()

function getDateRangeOfWeek(weekNo){
    var d1 = new Date();
    numOfdaysPastSinceLastMonday = eval(d1.getDay()- 1);
    d1.setDate(d1.getDate() - numOfdaysPastSinceLastMonday);
    var weekNoToday = d1.getWeek();
    var weeksInTheFuture = eval( weekNo - weekNoToday );
    d1.setDate(d1.getDate() + eval( 7 * weeksInTheFuture ));
    var rangeIsFrom = d1.getDate() +"/" + eval(d1.getMonth()+1)+ "/" + d1.getFullYear();
    d1.setDate(d1.getDate() + 6);
    var rangeIsTo = d1.getDate() +"/" + eval(d1.getMonth()+1)+ "/" + d1.getFullYear();
    return rangeIsFrom + " t/m "+rangeIsTo;
};

function changeWeek() {
    if (next_week) {
        document.getElementById("weekArrow").setAttribute("class", "fas fa-arrow-right")
        document.getElementById("week").childNodes[1].removeAttribute("hidden")
        document.getElementById("week").childNodes[2].setAttribute("hidden","hidden")
        next_week = false

        if (Cookies.get("id")) {
            id = getDefault()
            if (id[1] == false) {
                getStudentTable(id[0], date.getWeek())
            } else {
                getTeacherTable(id[0], date.getWeek())
            }
        }
    } else {
        document.getElementById("weekArrow").setAttribute("class", "fas fa-arrow-left")
        next_week = true

        week_ = date.getWeek()

        if (date.getWeek() == 53) {
            week_ = 1
        } else {
            week_ += 1
        }
        document.getElementById("week").childNodes[2].removeAttribute("hidden")
        document.getElementById("week").childNodes[1].setAttribute("hidden","hidden")

        if (Cookies.get("id")) {
            id = getDefault()
            if (id[1] == false) {
                getStudentTable(id[0], week_)
            } else {
                getTeacherTable(id[0], week_)
            }
        }
    }
}

function putInStudents() {
    html = '<select class="selectpicker" data-live-search="true" id="naam">'
    for (let i = 0; i < students.length; i++) {
        html += "<option value='" + students[i] + "'>" + students[i] + "</option>"
        if (i == (parseInt(students.length)-1)) {
            html += "</select>"
            document.getElementById("name__").innerHTML = html
        }
    }
}

function putInTeachers() {
    html_ = '<select class="selectpicker" data-live-search="true" id="shorty">'
    for (let i = 0; i < teachers.length; i++) {
        html_ += "<option value='" + teachers[i] + "'>" + teachers[i] + "</option>"
        if (i == (parseInt(teachers.length)-1)) {
            html_ += "</select>"
            document.getElementById("shorty__").innerHTML = html_
        }
    }
}

window.onload = function() {
	document.getElementById("week").childNodes[1].innerHTML = getDateRangeOfWeek(date.getWeek())
	document.getElementById("week").childNodes[2].innerHTML = getDateRangeOfWeek(date.getWeek()+1)

    if (Cookies.get("id")) {
		id = getDefault()

		changeWeek()
        if (id[1] == false) {
            getStudentTable(id[0], date.getWeek())
        } else {
            getTeacherTable(id[0], date.getWeek())
        }
    }
}

function setDefault(id, teacher){
    Cookies.set('id', id, { expires: 365 })
    Cookies.set('teacher', teacher, { expires: 365 })
    location.reload()
}

function getDefault(){
    if (Cookies.get('teacher') == "true"){
        return [Cookies.get('id'), true]
    } else {
        return [Cookies.get('id'), false]
    }
}

function getQueryString(field, url) {
	var href = url ? url : window.location.href;
	var reg = new RegExp( '[?&]' + field + '=([^&#]*)', 'i' );
	var string = reg.exec(href);
	return string ? string[1] : null;
}


function getStudentTable(unparsed, weekIn) {
    studentID = arraySearch(students, unparsed) + 1
    week = "";
    if (weekIn <= 9) {
        week = "0" + weekIn
    } else {
        week = weekIn
    }

    console.log(studentID)

    studentIDD = "";

    if (studentID <= 9) {
        studentIDD = "0000" + studentID
    } else if (studentID <= 99) {
        studentIDD = "000" + studentID
    } else if (studentID <= 999) {
        studentIDD = "00" + studentID
    }
	document.getElementById("iframe").src = "http://www4.olympuscollege.nl/roosters/inforooster/dagrooster/" + week + "/s/s" + studentIDD + ".htm"
    document.getElementById("iframe").removeAttribute("hidden")
    document.getElementById("options").setAttribute("hidden", "hidden")
}

function getTeacherTable(unparsed, weekIn) {
    teacherID = arraySearch(teachers, unparsed) + 1
    week = "";
    if (weekIn <= 9) {
        week = "0" + weekIn
    } else {
        week = weekIn
    }
    
    teacherIDD = "";

    if (teacherID <= 9) {
        teacherIDD = "0000" + teacherID
    } else if (teacherID <= 99) {
        teacherIDD = "000" + teacherID
    } else if (teacherID <= 999) {
        teacherIDD = "00" + teacherID
    }

    document.getElementById("iframe").src = "http://www4.olympuscollege.nl/roosters/inforooster/dagrooster/" + week + "/t/t" + teacherIDD + ".htm"
    document.getElementById("iframe").removeAttribute("hidden")
    document.getElementById("options").setAttribute("hidden", "hidden")
}

function openSettings() {
    document.getElementById("iframe").setAttribute("hidden", "hidden")
    document.getElementById("options").removeAttribute("hidden")
    //document.getElementById("oc_nummer").value = Cookies.get("number")
}

Date.prototype.getWeek = function() {
    var date = new Date(this.getTime());
     date.setHours(0, 0, 0, 0);
    // Thursday in current week decides the year.
    date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
    // January 4 is always in week 1.
    var week1 = new Date(date.getFullYear(), 0, 4);
    // Adjust to Thursday in week 1 and count number of weeks from date to week1.
    return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000
                          - 3 + (week1.getDay() + 6) % 7) / 7);
}

function arraySearch(arr,val) {
    for (var i=0; i<arr.length; i++)
        if (arr[i] === val)                    
            return i;
    return false;
}
$('document').ready(function() {
    putInStudents()
    putInTeachers()
    $('select').selectpicker();
})
